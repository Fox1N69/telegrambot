import telebot
import os
import wave
import requests
from io import BytesIO

token = '7077413288:AAE-Gy2YWkd0Jp30-bmliHn8DUpTUnn70Ks'
bot = telebot.TeleBot(token)

def save_voice_message(message):
    voice = message.voice
    if voice:
        file_info = bot.get_file(voice.file_id)
        file_url = f"https://api.telegram.org/file/bot{token}/{file_info.file_path}"
        response = requests.get(file_url)
        
        wav_file_path = f"voice_messages/{voice.file_id}.wav"  # Путь для сохранения конвертированного файла в формат .wav

        with wave.open(wav_file_path, 'wb') as wav_file:
            wav_file.setnchannels(1)  # Устанавливаем один канал
            wav_file.setsampwidth(2)  # Устанавливаем глубину бит на сэмпл
            wav_file.setframerate(16000)  # Устанавливаем частоту дискретизации 16 кГц

            wav_file.writeframes(response.content)

        bot.reply_to(message, "Голосовое сообщение успешно сохранено и сконвертировано в формат .wav")

@bot.message_handler(content_types=['voice'])
def handle_voice_message(message):
    save_voice_message(message)


if __name__ == '__main__':
  bot.infinity_polling()